{% extends "base.html" %} {% block title %}Patients List{%
endblock %} {% block content %}
<div class="container">
  <h2 class="my-4">Patients List</h2>
  {% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %}
  <div class="alert-container">
    {% for category, message in messages %}
    <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
    {% endfor %}
  </div>
  {% endif %} {% endwith %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Created Date</th>
        <th>Age</th>
        <th>Triage Class</th>
        <th>Result</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td>
          <a href="{{ url_for('patient_detail', patient_id=row.id) }}" style="color: inherit">{{ row.date }}</a>
        </td>
        <td>{{ row.age }}</td>
        <td>{{ row.conclusion.triage_class }}</td>
        <td>{{row.conclusion.result}}</td>
        <td>
          <a href="{{ url_for('edit_patient', id=row.id) }}" class="btn btn-warning btn-sm">
            <i class="fas fa-edit"></i>
          </a>
          <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deleteModal" data-id="{{ row.id }}">
            <i class="fas fa-trash-alt"></i>
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <a href="{{ url_for('download_excel_route') }}" class="btn btn-success">Excel İndir</a>
  <a href="{{ url_for('download_json_route') }}" class="btn btn-info">JSON İndir</a>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Delete Patient</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form method="post" action="{{ url_for('delete_patient') }}">
        <div class="modal-body">
          <input type="hidden" id="patient_id" name="id" />
          <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" class="form-control" id="password" name="password" required />
          </div>
          <p>Are you sure you want to delete this patient?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Cancel
          </button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
  $("#deleteModal").on("show.bs.modal", function (event) {
    var button = $(event.relatedTarget);
    var id = button.data("id");
    var modal = $(this);
    modal.find(".modal-body #patient_id").val(id);
  });
</script>

{% endblock %}